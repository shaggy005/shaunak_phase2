/* This file was generated by the Hex-Rays decompiler version 9.2.0.250908.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
__int64 sub_4006D0(); // weak
// int puts(const char *s);
// int fclose(FILE *stream);
// int printf(const char *format, ...);
// void *memset(void *s, int c, size_t n);
// void srand(unsigned int seed);
// char *fgets(char *s, int n, FILE *stream);
// time_t time(time_t *timer);
// int fflush(FILE *stream);
// FILE *fopen(const char *filename, const char *modes);
// __int64 __isoc99_scanf(const char *, ...); weak
// int rand(void);
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)());
FILE **deregister_tm_clones();
__int64 register_tm_clones();
FILE **_do_global_dtors_aux();
__int64 frame_dummy();
unsigned __int64 giveFlag();
int __fastcall main(int argc, const char **argv, const char **envp);
void _libc_csu_fini(); // idb
void term_proc();
// int _libc_start_main(int (*main)(int, char **, char **), int argc, char **ubp_av, void (*init)(), void (*fini)(), void (*rtld_fini)(), void *stack_end);
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN _libc_csu_init;
__int64 (__fastcall *_frame_dummy_init_array_entry[2])() = { &frame_dummy, &_do_global_dtors_aux }; // weak
__int64 (__fastcall *_do_global_dtors_aux_fini_array_entry)() = &_do_global_dtors_aux; // weak
__int64 (*qword_601010)(void) = NULL; // weak
FILE *stdout; // idb
char completed_7596; // weak


//----- (00000000004006B8) ----------------------------------------------------
// Alternative name is '_init'
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 601108: using guessed type __int64 _gmon_start__(void);

//----- (00000000004006D0) ----------------------------------------------------
__int64 sub_4006D0()
{
  return qword_601010();
}
// 4006D0: using guessed type __int64 sub_4006D0();
// 601010: using guessed type __int64 (*qword_601010)(void);

//----- (00000000004007A0) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)())
{
  __int64 v3; // rax
  int v4; // esi
  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main(
    (int (*)(int, char **, char **))main,
    v4,
    &retaddr,
    (void (*)())_libc_csu_init,
    _libc_csu_fini,
    a3,
    &v5);
  __halt();
}
// 4007A6: positive sp value 8 has been found
// 4007AD: variable 'v3' is possibly undefined

//----- (00000000004007D0) ----------------------------------------------------
FILE **deregister_tm_clones()
{
  return &stdout;
}

//----- (0000000000400800) ----------------------------------------------------
__int64 register_tm_clones()
{
  return 0;
}

//----- (0000000000400840) ----------------------------------------------------
FILE **_do_global_dtors_aux()
{
  FILE **result; // rax

  if ( !completed_7596 )
  {
    result = deregister_tm_clones();
    completed_7596 = 1;
  }
  return result;
}
// 601090: using guessed type char completed_7596;

//----- (0000000000400870) ----------------------------------------------------
__int64 frame_dummy()
{
  return register_tm_clones();
}

//----- (0000000000400877) ----------------------------------------------------
unsigned __int64 giveFlag()
{
  FILE *stream; // [rsp+8h] [rbp-118h]
  char s[264]; // [rsp+10h] [rbp-110h] BYREF
  unsigned __int64 v3; // [rsp+118h] [rbp-8h]

  v3 = __readfsqword(0x28u);
  memset(s, 0, 0x100u);
  stream = fopen("/home/h3/flag.txt", "r");
  if ( stream )
  {
    fgets(s, 256, stream);
    fclose(stream);
    puts(s);
  }
  else
  {
    puts("Flag file not found!  Contact an H3 admin for assistance.");
  }
  return __readfsqword(0x28u) ^ v3;
}

//----- (000000000040092B) ----------------------------------------------------
int __fastcall main(int argc, const char **argv, const char **envp)
{
  unsigned int v3; // eax
  int v5; // [rsp+10h] [rbp-10h] BYREF
  int v6; // [rsp+14h] [rbp-Ch]
  unsigned __int64 v7; // [rsp+18h] [rbp-8h]

  v7 = __readfsqword(0x28u);
  v3 = time(0);
  srand(v3);
  v6 = rand();
  puts("Welcome to the number guessing game!");
  puts("I'm thinking of a number. Can you guess it?");
  puts("Guess right and you get a flag!");
  printf("Enter your number: ");
  fflush(stdout);
  __isoc99_scanf("%u", &v5);
  printf("Your guess was %u.\n", v5);
  printf("Looking for %u.\n", v6);
  fflush(stdout);
  if ( v6 == v5 )
  {
    puts("You won. Guess was right! Here's your flag:");
    giveFlag();
  }
  else
  {
    puts("Sorry. Try again, wrong guess!");
  }
  fflush(stdout);
  return 0;
}
// 400780: using guessed type __int64 __isoc99_scanf(const char *, ...);

//----- (0000000000400A50) ----------------------------------------------------
void __fastcall _libc_csu_init(unsigned int a1, __int64 a2, __int64 a3)
{
  signed __int64 v3; // rbp
  __int64 i; // rbx

  v3 = &_do_global_dtors_aux_fini_array_entry - _frame_dummy_init_array_entry;
  init_proc();
  if ( v3 )
  {
    for ( i = 0; i != v3; ++i )
      _frame_dummy_init_array_entry[i]();
  }
}
// 600E10: using guessed type __int64 (__fastcall *_frame_dummy_init_array_entry[2])();
// 600E18: using guessed type __int64 (__fastcall *_do_global_dtors_aux_fini_array_entry)();

//----- (0000000000400AC4) ----------------------------------------------------
// Alternative name is '_fini'
void term_proc()
{
  ;
}

// nfuncs=38 queued=11 decompiled=11 lumina nreq=0 worse=0 better=0
// ALL OK, 11 function(s) have been successfully decompiled
